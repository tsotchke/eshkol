;; SCH-006: Comprehensive Differentiation Showcase
;; Demonstrates all three differentiation modes with interesting examples

(display "=== SCH-006: Comprehensive Differentiation Showcase ===")
(newline)
(newline)

;; ===== PART 1: SYMBOLIC DIFFERENTIATION =====
;; The diff operator produces s-expression formulas

(display "PART 1: Symbolic Differentiation (diff)")
(newline)
(display "Returns symbolic formulas as s-expressions")
(newline)
(newline)

;; Test 1: Quadratic function
(display "Test 1.1: d/dx(x²) = ")
(display (diff (* x x) x))
(newline)
(display "Expected: (* 2 x)")
(newline)
(newline)

;; Test 1.2: Linear function with mixed types
(display "Test 1.2: d/dx(2.5 * x) = ")
(display (diff (* 2.5 x) x))
(newline)
(display "Expected: 2.5 or 2.500000")
(newline)
(newline)

;; Test 1.3: Chain rule with trig
(display "Test 1.3: d/dx(sin(x²)) = ")
(display (diff (sin (* x x)) x))
(newline)
(display "Expected: (* (cos (* x x)) (* 2 x))")
(newline)
(newline)

;; Test 1.4: Product rule
(display "Test 1.4: d/dx(x³ * exp(x)) = ")
(display (diff (* (pow x 3) (exp x)) x))
(newline)
(display "Expected: (+ (* (* 3 (pow x 2)) (exp x)) (* (pow x 3) (exp x)))")
(newline)
(newline)

;; ===== PART 2: FORWARD-MODE AD (DUAL NUMBERS) =====
;; The derivative operator computes numerical values using dual numbers

(display "PART 2: Forward-Mode AD (derivative)")
(newline)
(display "Returns numerical derivative values")
(newline)
(newline)

;; Test 2.1: Quadratic at a point
(define f1 (lambda (x) (* x x)))
(display "Test 2.1: derivative of f(x)=x² at x=5")
(newline)
(display "Result: ")
(display (derivative f1 5.0))
(newline)
(display "Expected: 10.0")
(newline)
(newline)

;; Test 2.2: Scaling function
(define f2 (lambda (x) (* x 2.5)))
(display "Test 2.2: derivative of f(x)=2.5x at x=4")
(newline)
(display "Result: ")
(display (derivative f2 4.0))
(newline)
(display "Expected: 2.5")
(newline)
(newline)

;; Test 2.3: Complex composition
(define f3 (lambda (x) (exp (sin (* x x)))))
(display "Test 2.3: derivative of f(x)=exp(sin(x²)) at x=1")
(newline)
(display "Result: ")
(display (derivative f3 1.0))
(newline)
(display "Expected: ~2.507 (computed numerically)")
(newline)
(newline)

;; Test 2.4: Rational function
(define f4 (lambda (x) (/ (* x x) (+ x 1.0))))
(display "Test 2.4: derivative of f(x)=x²/(x+1) at x=2")
(newline)
(display "Result: ")
(display (derivative f4 2.0))
(newline)
(display "Expected: ~0.889 (8/9 from quotient rule)")
(newline)
(newline)

;; ===== PART 3: REVERSE-MODE AD (GRADIENTS) =====
;; The gradient operator computes gradients for multivariate functions

(display "PART 3: Reverse-Mode AD (gradient)")
(newline)
(display "Returns gradient vectors for multivariate functions")
(newline)
(newline)

;; Test 3.1: Multivariate quadratic  
(define g1 (lambda (v) 
  (+ (* (vref v 0) (vref v 0)) 
     (* (vref v 1) (vref v 1)))))
(display "Test 3.1: ∇(x² + y²) at (3,4)")
(newline)
(define grad1 (gradient g1 (vector 3.0 4.0)))
(display "Result: ")
(display grad1)
(newline)
(display "Expected: #(6 8) → [∂/∂x, ∂/∂y] = [2x, 2y]")
(newline)
(newline)

;; Test 3.2: Product function
(define g2 (lambda (v)
  (* (vref v 0) (vref v 1))))
(display "Test 3.2: ∇(x*y) at (5,7)")
(newline)
(define grad2 (gradient g2 (vector 5.0 7.0)))
(display "Result: ")
(display grad2)
(newline)
(display "Expected: #(7 5) → [∂/∂x, ∂/∂y] = [y, x]")
(newline)
(newline)

;; Test 3.3: Three variables with interaction
(define g3 (lambda (v)
  (+ (* (vref v 0) (vref v 1))
     (* (vref v 1) (vref v 2))
     (* (vref v 0) (vref v 2)))))
(display "Test 3.3: ∇(xy + yz + xz) at (1,2,3)")
(newline)
(define grad3 (gradient g3 (vector 1.0 2.0 3.0)))
(display "Result: ")
(display grad3)
(newline)
(display "Expected: #(5 4 3) → [y+z, x+z, x+y]")
(newline)
(newline)

(display "=== All Three Differentiation Modes Operational ===")
(newline)
(display "✓ Symbolic: Produces mathematical formulas")
(newline)
(display "✓ Forward:  Computes numerical derivatives (dual numbers)")  
(newline)
(display "✓ Reverse:  Computes gradients (backpropagation)")
(newline)