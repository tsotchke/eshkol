;; Validation Suite 1: Type Detection in Polymorphic Operations
;; Tests that polymorphicAdd/Sub/Mul/Div correctly detect AD_NODE_PTR types

(define (test-add-detection)
  (display "Test 1.1: Addition detects AD nodes")
  (newline)
  (define f (lambda (v) (+ (vref v 0) (vref v 1))))
  (define grad (gradient f (vector 3.0 5.0)))
  (display "Gradient of (x+y) at (3,5): ")
  (display grad)
  (newline)
  (display "Expected: vector(1.0, 1.0)")
  (newline)
  grad)

(define (test-mul-detection)
  (display "Test 1.2: Multiplication detects AD nodes")
  (newline)
  (define f (lambda (v) (* (vref v 0) (vref v 1))))
  (define grad (gradient f (vector 3.0 5.0)))
  (display "Gradient of (x*y) at (3,5): ")
  (display grad)
  (newline)
  (display "Expected: vector(5.0, 3.0) - product rule")
  (newline)
  grad)

(define (test-sub-detection)
  (display "Test 1.3: Subtraction detects AD nodes")
  (newline)
  (define f (lambda (v) (- (vref v 0) (vref v 1))))
  (define grad (gradient f (vector 5.0 3.0)))
  (display "Gradient of (x-y) at (5,3): ")
  (display grad)
  (newline)
  (display "Expected: vector(1.0, -1.0)")
  (newline)
  grad)

(define (test-div-detection)
  (display "Test 1.4: Division detects AD nodes")
  (newline)
  (define f (lambda (v) (/ (vref v 0) 2.0)))
  (define grad (gradient f (vector 6.0)))
  (display "Gradient of (x/2) at x=6: ")
  (display grad)
  (newline)
  (display "Expected: vector(0.5) - quotient rule")
  (newline)
  grad)

(define (main)
  (display "===============================================")
  (newline)
  (display "VALIDATION SUITE 1: Type Detection")
  (newline)
  (display "===============================================")
  (newline)
  (newline)
  
  (test-add-detection)
  (newline)
  (test-mul-detection)
  (newline)
  (test-sub-detection)
  (newline)
  (test-div-detection)
  
  (newline)
  (display "===============================================")
  (newline)
  (display "Type Detection Tests Complete")
  (newline)
  (display "===============================================")
  (newline)
  
  0)