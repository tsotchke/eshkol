;; Validation Suite 4: Tensor-AD Integration
;; Tests that tensor operations work correctly with AD nodes

(define (test-dot-product-gradient)
  (display "Test 4.1: Gradient of dot product v·v")
  (newline)
  (define f (lambda (v)
    (+ (* (vref v 0) (vref v 0))
       (* (vref v 1) (vref v 1))
       (* (vref v 2) (vref v 2)))))
  (define grad (gradient f (vector 1.0 2.0 3.0)))
  (display "Result: ")
  (display grad)
  (newline)
  (display "Expected: vector(2.0, 4.0, 6.0) - ∇(v·v) = 2v")
  (newline)
  grad)

(define (test-weighted-sum-gradient)
  (display "Test 4.2: Gradient of weighted sum")
  (newline)
  (define f (lambda (v)
    (+ (* 2.0 (vref v 0))
       (* 3.0 (vref v 1))
       (* 5.0 (vref v 2)))))
  (define grad (gradient f (vector 1.0 1.0 1.0)))
  (display "Result: ")
  (display grad)
  (newline)
  (display "Expected: vector(2.0, 3.0, 5.0) - constant coefficients")
  (newline)
  grad)

(define (test-cross-terms)
  (display "Test 4.3: Gradient with cross terms")
  (newline)
  (define f (lambda (v)
    (* (vref v 0) (vref v 1))))
  (define grad (gradient f (vector 3.0 4.0)))
  (display "Result: ")
  (display grad)
  (newline)
  (display "Expected: vector(4.0, 3.0) - [∂(xy)/∂x, ∂(xy)/∂y]")
  (newline)
  grad)

(define (main)
  (display "===============================================")
  (newline)
  (display "VALIDATION SUITE 4: Tensor-AD Integration")
  (newline)
  (display "===============================================")
  (newline)
  (newline)
  
  (test-dot-product-gradient)
  (newline)
  (test-weighted-sum-gradient)
  (newline)
  (test-cross-terms)
  
  (newline)
  (display "===============================================")
  (newline)
  (display "Tensor-AD Integration Tests Complete")
  (newline)
  (display "===============================================")
  (newline)
  
  0)