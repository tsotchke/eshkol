;; Test file for let expressions and global lambda definitions
;; This tests both BLOCKING issues from AUTODIFF_DEBUG_STABILIZATION.md

;; Test 1: Simple let expression
(display "Test 1: Simple let expression")
(newline)
(let ((x 5))
  (display x))
(newline)

;; Test 2: Let with multiple bindings
(display "Test 2: Let with multiple bindings")
(newline)
(let ((x 1) (y 2))
  (display (+ x y)))
(newline)

;; Test 3: Nested let expressions
(display "Test 3: Nested let expressions")
(newline)
(let ((x 10))
  (let ((y 20))
    (display (+ x y))))
(newline)

;; Test 4: Let with vector
(display "Test 4: Let with vector")
(newline)
(let ((v (vector 1.0 2.0 3.0)))
  (display v))
(newline)

;; Test 5: Global lambda definition (CRITICAL TEST)
(display "Tests 5&6: Call global lambda")
(newline)
(define test-func (lambda (v) 0.0))

;; Test 6: Call global lambda
(display (test-func 5.0))
(newline)

;; Test 7: Gradient with inline lambda (this already works)
(display "Test 7: Gradient with inline lambda (this already works)")
(newline)
(display (gradient (lambda (v) 0.0) (vector 1.0 2.0)))
(newline)

;; Test 8: Gradient with global lambda (CRITICAL - previously failed)
(display "Test 8: Gradient with global lambda (CRITICAL - previously failed)")
(newline)
(display (gradient test-func (vector 1.0 2.0)))
(newline)

;; Test 9: Let with lambda binding
(display "Test 9: Let with lambda binding")
(newline)
(let ((f (lambda (x) (* x 2))))
  (display (f 21)))
(newline)

;; Test 10: Nested lambda in let
(display "Test 10: Nested lambda in let")
(newline)
(let ((make-adder (lambda (n) (lambda (x) (+ x n)))))
  (let ((add5 (make-adder 5)))
    (display (add5 10))))