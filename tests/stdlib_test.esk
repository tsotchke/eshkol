;;; Test the Eshkol standard library

;; Include stdlib (for now, inline the definitions)

;; compose
(define (compose f g)
  (lambda (x) (f (g x))))

;; Test compose
(define add1 (lambda (x) (+ x 1)))
(define double (lambda (x) (* x 2)))
(define add1-then-double (compose double add1))

(display "Testing compose:")
(newline)
(display "add1-then-double 5 = ")
(display (add1-then-double 5))  ; (5+1)*2 = 12
(newline)

;; curry2
(define (curry2 f)
  (lambda (x)
    (lambda (y)
      (f x y))))

;; First-class operator wrappers (from stdlib)
(define (add x y) (+ x y))
(define (sub x y) (- x y))
(define (lt x y) (< x y))
(define (is-zero? x) (zero? x))

;; Test curry
(define curried-add (curry2 add))
(define add10 (curried-add 10))

(display "Testing curry2:")
(newline)
(display "add10 5 = ")
(display (add10 5))  ; 15
(newline)

;; identity
(define (identity x) x)

(display "Testing identity:")
(newline)
(display "identity 42 = ")
(display (identity 42))
(newline)

;; flip
(define (flip f)
  (lambda (x y) (f y x)))

(define flipped-sub (flip sub))
(display "Testing flip:")
(newline)
(display "flipped-sub 3 10 = ")
(display (flipped-sub 3 10))  ; 10 - 3 = 7
(newline)

;; negate
(define (negate pred)
  (lambda (x) (not (pred x))))

(define not-zero? (negate is-zero?))
(display "Testing negate:")
(newline)
(display "not-zero? 5 = ")
(display (not-zero? 5))  ; #t
(newline)
(display "not-zero? 0 = ")
(display (not-zero? 0))  ; #f
(newline)

;; Simple sort test
(define (merge l1 l2 less?)
  (cond ((null? l1) l2)
        ((null? l2) l1)
        ((less? (car l1) (car l2))
         (cons (car l1) (merge (cdr l1) l2 less?)))
        (else
         (cons (car l2) (merge l1 (cdr l2) less?)))))

(display "Testing merge:")
(newline)
(display "merge '(1 3 5) '(2 4 6) lt = ")
(display (merge '(1 3 5) '(2 4 6) lt))
(newline)

(display "All stdlib tests completed!")
(newline)
