;;
;; Test variadic map implementation using apply
;;

(display "=== VARIADIC MAP TEST ===")
(newline)

;; Helper: check if any list in a list-of-lists is null
(define (lists-any-null? lists)
  (if (null? lists)
      #f
      (if (null? (car lists))
          #t
          (lists-any-null? (cdr lists)))))

;; Helper: get all cars (first elements)
(define (all-cars lists)
  (if (null? lists)
      '()
      (cons (car (car lists))
            (all-cars (cdr lists)))))

;; Helper: get all cdrs (rest of each list)
(define (all-cdrs lists)
  (if (null? lists)
      '()
      (cons (cdr (car lists))
            (all-cdrs (cdr lists)))))

;; Variadic map: works with any number of lists
(define (vmap proc . lists)
  (if (lists-any-null? lists)
      '()
      (cons (apply proc (all-cars lists))
            (apply vmap (cons proc (all-cdrs lists))))))

;; TEST 1: Single list (like map1)
(display "TEST 1 - Single list: ")
(define (double x) (* x 2))
(display (vmap double (list 1 2 3 4)))
(newline)
;; Expected: (2 4 6 8)

;; TEST 2: Two lists (like map2)
(display "TEST 2 - Two lists: ")
(display (vmap + (list 1 2 3) (list 10 20 30)))
(newline)
;; Expected: (11 22 33)

;; TEST 3: Three lists (like map3)
(display "TEST 3 - Three lists: ")
(define (sum3 a b c) (+ a (+ b c)))
(display (vmap sum3 (list 1 2) (list 10 20) (list 100 200)))
(newline)
;; Expected: (111 222)

;; TEST 4: With lambda
(display "TEST 4 - With lambda: ")
(display (vmap (lambda (x y) (* x y)) (list 2 3 4) (list 5 6 7)))
(newline)
;; Expected: (10 18 28)

;; TEST 5: With closure
(display "TEST 5 - With closure: ")
(define factor 10)
(display (vmap (lambda (x) (* x factor)) (list 1 2 3)))
(newline)
;; Expected: (10 20 30)

;; TEST 6: Empty list
(display "TEST 6 - Empty list: ")
(display (vmap double '()))
(newline)
;; Expected: ()

;; TEST 7: Unequal lengths (stops at shortest)
(display "TEST 7 - Unequal lengths: ")
(display (vmap + (list 1 2 3 4 5) (list 10 20)))
(newline)
;; Expected: (11 22)

(newline)
(display "=== ALL VARIADIC MAP TESTS COMPLETE ===")
(newline)
