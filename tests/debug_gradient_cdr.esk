;; Debug test: gradient with cdr specifically
(require stdlib)

;; Test 1: Just use cadr (car (cdr ...)) to isolate the issue
(define (just-y v)
  (let ((y (cadr v)))
    (* y y)))

(display "Test 1: just-y = y^2")
(newline)
(display "Gradient of just-y at (3.0, 4.0): ")
(display (gradient just-y (vector 3.0 4.0)))
(display " (expected: #(0 8))")
(newline)
(newline)

;; Test 2: Use car (cdr ...) explicitly instead of cadr
(define (just-y2 v)
  (let ((y (car (cdr v))))
    (* y y)))

(display "Test 2: just-y2 = y^2 using car(cdr)")
(newline)
(display "Gradient of just-y2 at (3.0, 4.0): ")
(display (gradient just-y2 (vector 3.0 4.0)))
(display " (expected: #(0 8))")
(newline)
(newline)

;; Test 3: What does (cdr v) return in gradient context?
;; Use a function that operates on (cdr v) directly
(define (sum-cdr v)
  (let ((tail (cdr v)))
    (car tail)))  ;; Just get first element of tail

(display "Test 3: sum-cdr - just gets (car (cdr v))")
(newline)
(display "Gradient of sum-cdr at (3.0, 4.0): ")
(display (gradient sum-cdr (vector 3.0 4.0)))
(display " (expected: #(0 1))")
(newline)
(newline)

;; Test 4: Use vref to get element 1 directly
(define (vref-y v)
  (let ((y (vref v 1)))
    (* y y)))

(display "Test 4: vref-y = y^2 using vref")
(newline)
(display "Gradient of vref-y at (3.0, 4.0): ")
(display (gradient vref-y (vector 3.0 4.0)))
(display " (expected: #(0 8))")
(newline)

0
