;; Test medium matrix algorithms (BLOCKED algorithm for 5x5 to 64x64 matrices)
;; This demonstrates cache-efficient blocked matrix multiplication

(define (main)
  (printf "=== Medium Matrix Algorithm Test (BLOCKED/Cache-Efficient) ===\\n")
  
  ;; Test 1: 5x5 Matrix (smallest size to trigger BLOCKED algorithm)
  (printf "\\n1. Testing 5x5 Matrix Multiplication:\\n")
  (printf "   Algorithm: BLOCKED (cache-efficient blocked multiplication)\\n")
  (printf "   Expected complexity: O(n³) but with better cache locality\\n")
  (printf "   This algorithm divides matrices into blocks for better memory access\\n")
  
  (define A5 (matrix 5 5 1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1))
  (define B5 (matrix 5 5 1 2 3 4 5 2 3 4 5 1 3 4 5 1 2 4 5 1 2 3 5 1 2 3 4))
  
  (printf "   Matrix A5 (5x5 identity): First row [%d,%d,%d,%d,%d]\\n"
          (tensor-get A5 0) (tensor-get A5 1) (tensor-get A5 2) (tensor-get A5 3) (tensor-get A5 4))
  (printf "   Matrix B5 (5x5 pattern): First row [%d,%d,%d,%d,%d]\\n"
          (tensor-get B5 0) (tensor-get B5 1) (tensor-get B5 2) (tensor-get B5 3) (tensor-get B5 4))
  (printf "   Computing A5 × B5...\\n")
  
  (define C5 (tensor-dot A5 B5))
  (printf "   Result C5: First row [%d,%d,%d,%d,%d] (should equal B5's first row)\\n"
          (tensor-get C5 0) (tensor-get C5 1) (tensor-get C5 2) (tensor-get C5 3) (tensor-get C5 4))
  
  ;; Test 2: 8x8 Matrix - Classic medium size
  (printf "\\n2. Testing 8x8 Matrix Multiplication:\\n")
  (printf "   Algorithm: BLOCKED (optimal block size for cache performance)\\n")
  (printf "   Benefits: Improved cache hit ratio, reduced memory bandwidth usage\\n")
  
  (define A8 (matrix 8 8 
    1 0 0 0 0 0 0 0
    0 1 0 0 0 0 0 0  
    0 0 1 0 0 0 0 0
    0 0 0 1 0 0 0 0
    0 0 0 0 1 0 0 0
    0 0 0 0 0 1 0 0
    0 0 0 0 0 0 1 0
    0 0 0 0 0 0 0 1))
    
  (define B8 (matrix 8 8
    2 1 1 1 1 1 1 1
    1 2 1 1 1 1 1 1
    1 1 2 1 1 1 1 1  
    1 1 1 2 1 1 1 1
    1 1 1 1 2 1 1 1
    1 1 1 1 1 2 1 1
    1 1 1 1 1 1 2 1
    1 1 1 1 1 1 1 2))
  
  (printf "   Matrix A8 (8x8 identity): First row [%d,%d,%d,%d,%d,%d,%d,%d]\\n"
          (tensor-get A8 0) (tensor-get A8 1) (tensor-get A8 2) (tensor-get A8 3)
          (tensor-get A8 4) (tensor-get A8 5) (tensor-get A8 6) (tensor-get A8 7))
          
  (printf "   Matrix B8 (8x8 diagonal+1): First row [%d,%d,%d,%d,%d,%d,%d,%d]\\n"
          (tensor-get B8 0) (tensor-get B8 1) (tensor-get B8 2) (tensor-get B8 3)
          (tensor-get B8 4) (tensor-get B8 5) (tensor-get B8 6) (tensor-get B8 7))
  
  (printf "   Computing A8 × B8...\\n")
  (define C8 (tensor-dot A8 B8))
  
  (printf "   Result C8: First row [%d,%d,%d,%d,%d,%d,%d,%d]\\n"
          (tensor-get C8 0) (tensor-get C8 1) (tensor-get C8 2) (tensor-get C8 3)
          (tensor-get C8 4) (tensor-get C8 5) (tensor-get C8 6) (tensor-get C8 7))
  (printf "   Expected: First row should be [2,1,1,1,1,1,1,1] (identity × B = B)\\n")
  
  ;; Test 3: 16x16 Matrix - Larger medium size
  (printf "\\n3. Testing 16x16 Matrix (larger blocked case):\\n")
  (printf "   Algorithm: BLOCKED with multiple cache-friendly blocks\\n")
  (printf "   Expected operations: 16³ = 4,096 scalar multiplications\\n")
  
  ;; Create simple pattern matrices for 16x16 
  (printf "   Creating 16x16 test matrices...\\n")
  (define A16 (matrix 16 16 
    1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
    0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0
    0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0
    0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0
    0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0
    0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0
    0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0
    0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0
    0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0
    0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0
    0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0
    0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0
    0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0
    0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1))
  
  (define B16_pattern (matrix 16 16
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1))
  
  (printf "   Computing A16 × B16_pattern...\\n")
  (define C16 (tensor-dot A16 B16_pattern))
  (printf "   Result C16: First four elements [%d,%d,%d,%d] (should all be 1)\\n"
          (tensor-get C16 0) (tensor-get C16 1) (tensor-get C16 2) (tensor-get C16 3))
  
  (printf "\\n=== Summary: BLOCKED Algorithm Performance ===\\n")
  (printf "✓ 5x5 matrices: Uses BLOCKED algorithm for cache efficiency\\n")
  (printf "✓ 8x8 matrices: 512 operations with improved memory access\\n") 
  (printf "✓ 16x16 matrices: 4,096 operations with block-wise computation\\n")
  (printf "✓ Cache benefits: Reduced memory bandwidth, better locality\\n")
  (printf "✓ All medium matrix tests completed successfully\\n")
  (printf "\\n=== Medium Matrix Test Complete ===\\n")
  0)